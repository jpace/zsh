#!/usr/bin/zsh
# -*- sh-mode -*-

# front end for all the "em" commands

typeset -gA em_aliases

em_aliases=(
    pwd   current-directory
    pwf   current-file
    o     open
    fs    files
    b     current-basename
    r     current-rootname
)

subcmd=$1
prefix=em

if [[ $# -eq 0 ]]
then
    dir=$0:h
    echo "subcommands:"
    for i in $dir/$prefix-*(.)
    do
        n=`echo $i:t:r | sed -e "s/$prefix-//"`
        echo "    $n"
    done
    exit 1
fi

shift

alias=${em_aliases[$subcmd]}

if [[ "$alias" ]]
then
    subcmd=$alias
fi

prog="$prefix-$subcmd"
for extname in "" .rb .sh .zsh
do
    name=$prog$extname
    if whence $name >/dev/null
    then
        "$name" "$@"
        exit $?
    fi
done

echo "not valid: $prog" >&2
exit 1
